# ADR-0021: Каркас SPA — роутинг, layout, состояние, i18n (FE-001)

## Статус

Принято.

## Контекст

После завершения backend API (этапы B и C) и bootstrap frontend (INIT-003) необходимо превратить заглушки страниц в полноценный каркас SPA: рабочий роутинг, расширенные i18n-словари, API-клиент для всех endpoint'ов, типизация доменных объектов и функциональные страницы.

## Решения

### 1. State management — локальный state + fetch-on-demand

Для v1 (одиночный пользователь, локальный деплой) выбран подход без глобального стора. Каждая страница загружает данные напрямую через API-клиент и держит их в локальном `useState`. Это минимизирует зависимости и сложность. При необходимости масштабирования (WebSockets, кеширование) можно добавить React Context или внешний стор позже.

### 2. i18n-словари — полное покрытие ключей

Словари расширены до полного набора ключей для всех экранов, включая:
- названия стадий (`stages.*`),
- маппинг кодов ошибок backend (`errors.*`),
- подписи UI-элементов всех страниц.

Это исключает хардкод строк в компонентах и обеспечивает инвариант проекта по локализации.

### 3. Маппинг ошибок backend → i18n

`ApiClientError` содержит `code` из backend-ответа. В компонентах используется `t(\`errors.${code}\`)` с `defaultValue` как fallback — единообразный механизм без switch/case.

### 4. Роутинг — три страницы

- `/` — список типов (MainPage)
- `/types/new` — создание типа (CreateTypePage)
- `/types/:typeId` — детали типа с историей (TypeDetailsPage)

`/types/new` размещён в роутере до `/types/:typeId`, чтобы React Router не интерпретировал `new` как `typeId`.

### 5. API client — полное покрытие endpoint'ов v1

Исправлено несоответствие полей ответа ошибок (backend возвращает `message`, а не `detail`). Добавлены типизированные методы для всех 7 endpoint'ов API.

### 6. Доменные типы фронтенда

В `shared/api/types.ts` добавлены `StageCode`, `STAGES`, `STAGE_INDEX` и интерфейсы, соответствующие Pydantic-схемам backend. Это единый источник истины стадий на стороне фронтенда.

## Последствия

- Весь текст в UI идёт через i18n (RU/EN), переключение «на лету» без потери состояния.
- API-клиент полностью типизирован и готов к использованию всеми экранами.
- Последующие задачи FE-002…FE-007 могут сфокусироваться на UX-деталях, не пересоздавая каркас.
