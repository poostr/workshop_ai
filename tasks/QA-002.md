# QA-002: Unit/Integration tests: move (конкурентность и инварианты)

## Статус: Выполнено

## Что сделано

### Добавлен файл тестов `backend/tests/test_move_concurrency.py`

**Тесты конкурентности (3 шт.)**:
- `test_concurrent_single_unit_moves_never_overdraw` — 20 параллельных запросов × 1 шт. при 10 доступных; подтверждает ровно 10 успехов, 0 overdraw
- `test_concurrent_batch_moves_respect_available_qty` — 6 параллельных запросов × 5 шт. при 15 доступных; подтверждает ровно 3 успеха
- `test_concurrent_moves_on_different_stages_are_independent` — конкурентные перемещения из IN_BOX и BUILDING одновременно

**Тесты инвариантов (5 шт.)**:
- `test_move_exact_qty_drains_source_to_zero` — граничный кейс: count → 0
- `test_move_skip_stages_is_allowed` — IN_BOX → DONE (пропуск промежуточных)
- `test_move_same_stage_is_rejected` — from == to → ERR_INVALID_STAGE_TRANSITION
- `test_move_nonexistent_type_returns_404` — 404 для несуществующего типа
- `test_sequential_moves_accumulate_correctly` — сложный multi-step сценарий

## Результаты
- 33 теста passed (25 существующих + 8 новых)
- Конкурентные тесты стабильны (не flaky)

## ADR
- [ADR-0029](../ADR/ADR-0029-move-concurrency-tests-qa-002.md)
